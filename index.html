<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camino Invoice Checker</title>
    <style>
        :root {
            --primary: #FFB512;
            --secondary: #121C33;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--secondary);
            color: white;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            color: var(--secondary);
        }

        h1 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 30px;
        }

        .upload-section {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .file-input {
            margin-bottom: 15px;
        }

        .api-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .submit-btn {
            background-color: var(--primary);
            color: var(--secondary);
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            font-size: 16px;
        }

        .submit-btn:hover {
            opacity: 0.9;
        }

        .results {
            display: none;
            margin-top: 30px;
        }

        .check-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 8px;
        }

        .icon {
            font-size: 24px;
            margin-right: 15px;
            min-width: 30px;
            text-align: center;
        }

        .check-content {
            flex-grow: 1;
        }

        .check-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .summary {
            margin-top: 30px;
            padding: 20px;
            background-color: var(--primary);
            border-radius: 8px;
            color: var(--secondary);
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Camino Invoice Checker</h1>
        
        <div class="upload-section">
            <div class="file-input">
                <label for="po">Purchase Order:</label><br>
                <input type="file" id="po" accept=".pdf,.doc,.docx">
            </div>
            
            <div class="file-input">
                <label for="invoice">Draft Invoice:</label><br>
                <input type="file" id="invoice" accept=".pdf,.doc,.docx">
            </div>
            
            <div>
                <label for="api-key">Claude API Key:</label><br>
                <input type="password" id="api-key" class="api-input" placeholder="Enter your API key">
            </div>
            
            <button class="submit-btn" onclick="validateInvoice()">Validate Invoice</button>
        </div>

        <div class="loading">
            <div class="spinner"></div>
            <p>Analyzing documents...</p>
        </div>

        <div class="results">
            <div class="check-item">
                <div class="icon">✓</div>
                <div class="check-content">
                    <div class="check-title">Job Number and Description</div>
                    <div class="check-explanation"></div>
                </div>
            </div>

            <div class="check-item">
                <div class="icon">✓</div>
                <div class="check-content">
                    <div class="check-title">PO Number Match</div>
                    <div class="check-explanation"></div>
                </div>
            </div>

            <div class="check-item">
                <div class="icon">✓</div>
                <div class="check-content">
                    <div class="check-title">Billing Address</div>
                    <div class="check-explanation"></div>
                </div>
            </div>

            <div class="check-item">
                <div class="icon">✓</div>
                <div class="check-content">
                    <div class="check-title">Currency Match</div>
                    <div class="check-explanation"></div>
                </div>
            </div>

            <div class="check-item">
                <div class="icon">✓</div>
                <div class="check-content">
                    <div class="check-title">VAT Application</div>
                    <div class="check-explanation"></div>
                </div>
            </div>

            <div class="check-item">
                <div class="icon">✓</div>
                <div class="check-content">
                    <div class="check-title">Payment Terms</div>
                    <div class="check-explanation"></div>
                </div>
            </div>

            <div class="summary">
                <h3>The Queen's Verdict</h3>
                <p id="summary-text"></p>
            </div>
        </div>
    </div>

    <script>
        async function validateInvoice() {
            const po = document.getElementById('po').files[0];
            const invoice = document.getElementById('invoice').files[0];
            const apiKey = document.getElementById('api-key').value;

            if (!po || !invoice || !apiKey) {
                alert('Please provide all required files and API key');
                return;
            }

            // Show loading state
            document.querySelector('.loading').style.display = 'block';
            document.querySelector('.results').style.display = 'none';

            try {
                // Convert files to base64
                const poBase64 = await fileToBase64(po);
                const invoiceBase64 = await fileToBase64(invoice);

                // Prepare the prompt for Claude
                const prompt = `Please analyze these two documents. The first is a Purchase Order (PO) and the second is a draft invoice. Check the following criteria and provide a structured response:

                1. Job Number and Description: Check if the invoice includes a job number (format: JJEUGA2401, TXUKYS2404, etc.) and description
                2. PO Number: Verify if the invoice's PO number matches the supplied PO
                3. Billing Address: Confirm if the invoice uses the correct billing address from the PO
                4. Currency: Verify if the currency matches between documents
                5. VAT Application: Check if VAT is correctly applied based on the billing address
                6. Payment Terms: Verify if the invoice meets the PO's payment terms

                Finally, provide a brief summary with a sassy, queen-like tone.

                Format your response in JSON like this:
                {
                    "jobNumber": {
                        "pass": true/false,
                        "explanation": "explanation text"
                    },
                    "poNumber": {
                        "pass": true/false,
                        "explanation": "explanation text"
                    },
                    "billingAddress": {
                        "pass": true/false,
                        "explanation": "explanation text"
                    },
                    "currency": {
                        "pass": true/false,
                        "explanation": "explanation text"
                    },
                    "vat": {
                        "pass": true/false,
                        "explanation": "explanation text"
                    },
                    "paymentTerms": {
                        "pass": true/false,
                        "explanation": "explanation text"
                    },
                    "summary": "Queen's summary text"
                }

                Here are the base64-encoded documents:

                PO: ${poBase64}
                Invoice: ${invoiceBase64}`;

                // Call Claude API
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: "claude-3-opus-20240229",
                        max_tokens: 1024,
                        messages: [{
                            role: "user",
                            content: prompt
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error('API call failed');
                }

                const data = await response.json();
                const result = JSON.parse(data.content[0].text);

                // Update UI with results
                updateResults(result);
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while processing the documents');
            } finally {
                document.querySelector('.loading').style.display = 'none';
            }
        }

        function updateResults(result) {
            const results = document.querySelector('.results');
            const checkItems = results.querySelectorAll('.check-item');
            
            // Update each check item
            const checks = ['jobNumber', 'poNumber', 'billingAddress', 'currency', 'vat', 'paymentTerms'];
            checks.forEach((check, index) => {
                const item = checkItems[index];
                const icon = item.querySelector('.icon');
                const explanation = item.querySelector('.check-explanation');
                
                icon.textContent = result[check].pass ? '✓' : '✗';
                icon.style.color = result[check].pass ? 'green' : 'red';
                explanation.textContent = result[check].explanation;
            });

            // Update summary
            document.getElementById('summary-text').textContent = result.summary;

            // Show results
            results.style.display = 'block';
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }
    </script>
</body>
</html>
